import { Database } from 'duckdb-async';

let db: Database | null = null;
export async function initializeDB() {
  console.log('initializeDB function called');

  if (db) {
    console.log('Reusing existing connection');
    return db;
  }
  try {
    console.log('Creating new db connection');
    db = await Database.create(':memory:');
    console.log('DB connection created successfully');

    const testResult = await db.all('SELECT 1 AS test');
    console.log('Connection test result:', testResult);

    await db.run('INSTALL spatial');
    await db.run('LOAD spatial');
    await db.run(`CREATE TABLE IF NOT EXISTS world_points (
    id INTEGER,
    location_name VARCHAR,
    geom GEOMETRY
);`);
    await db.run(`INSERT INTO world_points (id, location_name, geom) VALUES
(0, 'New York City', ST_Point(40.7128, -74.0060)),
(1, 'Los Angeles', ST_Point(34.0522, -118.2437)),
(2, 'Chicago', ST_Point(41.8781, -87.6298)),
(3, 'Houston', ST_Point(29.7604, -95.3698)),
(4, 'Phoenix', ST_Point(33.4484, -112.0740)),
(5, 'Philadelphia', ST_Point(39.9526, -75.1652)),
(6, 'San Antonio', ST_Point(29.4241, -98.4936)),
(7, 'San Diego', ST_Point(32.7157, -117.1611)),
(8, 'Dallas', ST_Point(32.7767, -96.7970)),
(9, 'San Jose', ST_Point(37.3382, -121.8863)),
(10, 'Austin', ST_Point(30.2672, -97.7431)),
(11, 'Jacksonville', ST_Point(30.3322, -81.6557)),
(12, 'San Francisco', ST_Point(37.7749, -122.4194)),
(13, 'Indianapolis', ST_Point(39.7684, -86.1581)),
(14, 'Columbus', ST_Point(39.9612, -82.9988)),
(15, 'Fort Worth', ST_Point(32.7555, -97.3308)),
(16, 'Charlotte', ST_Point(35.2271, -80.8431)),
(17, 'Seattle', ST_Point(47.6062, -122.3321)),
(18, 'Denver', ST_Point(39.7392, -104.9903)),
(19, 'Washington, D.C.', ST_Point(38.9072, -77.0369)),
(20, 'Boston', ST_Point(42.3601, -71.0589)),
(21, 'El Paso', ST_Point(31.7619, -106.4850)),
(22, 'Detroit', ST_Point(42.3314, -83.0458)),
(23, 'Nashville', ST_Point(36.1627, -86.7816)),
(24, 'Memphis', ST_Point(35.1495, -90.0490)),
(25, 'Portland', ST_Point(45.5152, -122.6784)),
(26, 'Oklahoma City', ST_Point(35.4676, -97.5164)),
(27, 'Las Vegas', ST_Point(36.1699, -115.1398)),
(28, 'Baltimore', ST_Point(39.2904, -76.6122)),
(29, 'Louisville', ST_Point(38.2527, -85.7585)),
(30, 'Milwaukee', ST_Point(43.0389, -87.9065)),
(31, 'Albuquerque', ST_Point(35.0844, -106.6504)),
(32, 'Tucson', ST_Point(32.2226, -110.9747)),
(33, 'Fresno', ST_Point(36.7378, -119.7871)),
(34, 'Sacramento', ST_Point(38.5816, -121.4944)),
(35, 'Kansas City', ST_Point(39.0997, -94.5786)),
(36, 'Mesa', ST_Point(33.4152, -111.8315)),
(37, 'Atlanta', ST_Point(33.7490, -84.3880)),
(38, 'Omaha', ST_Point(41.2565, -95.9345)),
(39, 'Raleigh', ST_Point(35.7796, -78.6382)),
(40, 'Miami', ST_Point(25.7617, -80.1918)),
(41, 'Minneapolis', ST_Point(44.9778, -93.2650)),
(42, 'Tulsa', ST_Point(36.1540, -95.9928)),
(43, 'Cleveland', ST_Point(41.4993, -81.6944)),
(44, 'New Orleans', ST_Point(29.9511, -90.0715)),
(45, 'Honolulu', ST_Point(21.3069, -157.8583)),
(46, 'Anchorage', ST_Point(61.2181, -149.9003)),
(47, 'Santa Fe', ST_Point(35.6869, -105.9378)),
(48, 'Vancouver', ST_Point(49.2827, -123.1207)),
(49, 'Toronto', ST_Point(43.6510, -79.3470)),
(50, 'Montreal', ST_Point(45.5017, -73.5673)),
(51, 'Calgary', ST_Point(51.0447, -114.0719)),
(52, 'Ottawa', ST_Point(45.4215, -75.6972)),
(53, 'Edmonton', ST_Point(53.5461, -113.4938)),
(54, 'Quebec City', ST_Point(46.8139, -71.2082)),
(55, 'Winnipeg', ST_Point(49.8951, -97.1384)),
(56, 'Halifax', ST_Point(44.6488, -63.5752)),
(57, 'Regina', ST_Point(50.4452, -104.6189)),
(58, 'Saskatoon', ST_Point(52.1332, -106.6700)),
(59, 'Monterrey', ST_Point(25.6866, -100.3161)),
(60, 'Guadalajara', ST_Point(20.6597, -103.3496)),
(61, 'Puebla', ST_Point(19.0414, -98.2063)),
(62, 'Tijuana', ST_Point(32.5149, -117.0382)),
(63, 'Ciudad Juárez', ST_Point(31.6904, -106.4245)),
(64, 'Cancun', ST_Point(21.1619, -86.8515)),
(65, 'Culiacán', ST_Point(24.8091, -107.3940)),
(66, 'Saltillo', ST_Point(25.4387, -100.9995)),
(67, 'Mérida', ST_Point(20.9674, -89.5926)),
(68, 'León', ST_Point(21.1619, -101.6868)),
(69, 'Acapulco', ST_Point(16.8531, -99.8237)),
(70, 'Toluca', ST_Point(19.2826, -99.6557)),
(71, 'Maracaibo', ST_Point(10.6545, -71.6345)),
(72, 'Caracas', ST_Point(10.4806, -66.9036)),
(73, 'Medellín', ST_Point(6.2442, -75.5812)),
(74, 'Cali', ST_Point(3.4516, -76.5319)),
(75, 'Barranquilla', ST_Point(10.9685, -74.7813)),
(76, 'Cartagena', ST_Point(10.3910, -75.4794)),
(77, 'Lima', ST_Point(-12.0464, -77.0428)),
(78, 'Cusco', ST_Point(-13.5319, -71.9675)),
(79, 'Arequipa', ST_Point(-16.4090, -71.5375)),
(80, 'Bogotá', ST_Point(4.7110, -74.0721)),
(81, 'Quito', ST_Point(-0.1807, -78.4678)),
(82, 'Guayaquil', ST_Point(-2.1700, -79.9224)),
(83, 'La Paz', ST_Point(-16.5000, -68.1500)),
(84, 'Santa Cruz de la Sierra', ST_Point(-17.7833, -63.1821)),
(85, 'Brasília', ST_Point(-15.8267, -47.9218)),
(86, 'São Paulo', ST_Point(-23.5505, -46.6333)),
(87, 'Rio de Janeiro', ST_Point(-22.9068, -43.1729)),
(88, 'Salvador', ST_Point(-12.9777, -38.5016)),
(89, 'Recife', ST_Point(-8.0476, -34.8770)),
(90, 'Belo Horizonte', ST_Point(-19.9167, -43.9345)),
(91, 'Porto Alegre', ST_Point(-30.0346, -51.2177)),
(92, 'Curitiba', ST_Point(-25.4284, -49.2733)),
(93, 'Fortaleza', ST_Point(-3.7319, -38.5267)),
(241, 'Ahmedabad', ST_Point(23.0225, 72.5714)),
(242, 'Baghdad', ST_Point(33.3152, 44.3661)),
(243, 'Bangkok', ST_Point(13.7563, 100.5018)),
(244, 'Beijing', ST_Point(39.9042, 116.4074)),
(245, 'Bangalore', ST_Point(12.9716, 77.5946)),
(246, 'Bandar Seri Begawan', ST_Point(4.9031, 114.9398)),
(247, 'Beirut', ST_Point(33.8938, 35.5018)),
(248, 'Cebu City', ST_Point(10.3157, 123.8854)),
(249, 'Colombo', ST_Point(6.9271, 79.8612)),
(250, 'Damascus', ST_Point(33.5138, 36.2765)),
(251, 'Dhaka', ST_Point(23.8103, 90.4125)),
(252, 'Dubai', ST_Point(25.2048, 55.2708)),
(253, 'Doha', ST_Point(25.2769, 51.5200)),
(254, 'Hanoi', ST_Point(21.0285, 105.8542)),
(255, 'Homs', ST_Point(34.7324, 36.7131)),
(256, 'Ho Chi Minh City', ST_Point(10.7769, 106.7009)),
(257, 'Islamabad', ST_Point(33.6844, 73.0479)),
(258, 'Istanbul', ST_Point(41.0082, 28.9784)),
(259, 'Jakarta', ST_Point(6.2088, 106.8456)),
(260, 'Jerusalem', ST_Point(31.7683, 35.2137)),
(261, 'Karachi', ST_Point(24.8607, 67.0011)),
(262, 'Kabul', ST_Point(34.5553, 69.2075)),
(263, 'Kathmandu', ST_Point(27.7172, 85.3240)),
(264, 'Kuala Lumpur', ST_Point(3.1390, 101.6869)),
(265, 'Kuwait City', ST_Point(29.3759, 47.9774)),
(266, 'Lahore', ST_Point(31.5497, 74.3436)),
(267, 'Manila', ST_Point(14.5995, 120.9842)),
(268, 'Mumbai', ST_Point(19.0760, 72.8777)),
(269, 'Muscat', ST_Point(23.5859, 58.4059)),
(270, 'Naypyidaw', ST_Point(19.7633, 96.0785)),
(271, 'New Delhi', ST_Point(28.6139, 77.2090)),
(272, 'Nicosia', ST_Point(35.1667, 33.3667)),
(273, 'Osaka', ST_Point(34.6937, 135.5023)),
(274, 'Phnom Penh', ST_Point(11.5564, 104.9282)),
(275, 'Pyongyang', ST_Point(39.0392, 125.7625)),
(276, 'Riyadh', ST_Point(24.7136, 46.6753)),
(277, 'Sana', ST_Point(15.3694, 44.1910)),
(278, 'Seoul', ST_Point(37.5665, 126.9780)),
(279, 'Shanghai', ST_Point(31.2304, 121.4737)),
(280, 'Singapore', ST_Point(1.3521, 103.8198)),
(281, 'Surabaya', ST_Point(-7.2575, 112.7521)),
(282, 'Taipei', ST_Point(25.0330, 121.5654)),
(283, 'Tashkent', ST_Point(41.2995, 69.2401)),
(284, 'Tehran', ST_Point(35.6892, 51.3890)),
(285, 'Tokyo', ST_Point(35.6895, 139.6917)),
(286, 'Ulaanbaatar', ST_Point(47.8864, 106.9057)),
(287, 'Vientiane', ST_Point(17.9757, 102.6331)),
(288, 'Yerevan', ST_Point(40.1792, 44.4991)),
(289, 'Amman', ST_Point(31.9454, 35.9284)),
(290, 'Ankara', ST_Point(39.9208, 32.8541)),
(291, 'Baku', ST_Point(40.4093, 49.8671)),
(292, 'Bangkok', ST_Point(13.7563, 100.5018)),
(293, 'Beijing', ST_Point(39.9042, 116.4074)),
(294, 'Busan', ST_Point(35.1796, 129.0756)),
(295, 'Chennai', ST_Point(13.0827, 80.2707)),
(296, 'Chittagong', ST_Point(22.3475, 91.8123)),
(297, 'Cochin', ST_Point(9.9312, 76.2673)),
(298, 'Davao City', ST_Point(7.1907, 125.4553)),
(299, 'Dhaka', ST_Point(23.8103, 90.4125)),
(300, 'Guangzhou', ST_Point(23.1291, 113.2644)),
(301, 'Haiphong', ST_Point(20.8449, 106.6881)),
(302, 'Hyderabad', ST_Point(17.3850, 78.4867)),
(303, 'Jaipur', ST_Point(26.9124, 75.7873)),
(304, 'Jeddah', ST_Point(21.4858, 39.1925)),
(305, 'Karachi', ST_Point(24.8607, 67.0011)),
(306, 'Kolkata', ST_Point(22.5726, 88.3639)),
(307, 'Kyoto', ST_Point(35.0116, 135.7681)),
(308, 'Lagos', ST_Point(6.5244, 3.3792)),
(309, 'Lanzhou', ST_Point(36.0611, 103.8343)),
(310, 'Madurai', ST_Point(9.9252, 78.1198)),
(311, 'Nagpur', ST_Point(21.1458, 79.0882)),
(312, 'Pune', ST_Point(18.5204, 73.8567)),
(313, 'Rawalpindi', ST_Point(33.5651, 73.0169)),
(314, 'Sapporo', ST_Point(43.0621, 141.3544)),
(315, 'Semarang', ST_Point(-6.9666, 110.4167)),
(316, 'Tainan', ST_Point(23.0000, 120.2000)),
(317, 'Tiruchirappalli', ST_Point(10.7905, 78.7047)),
(318, 'Udaipur', ST_Point(24.5854, 73.7125)),
(319, 'Varanasi', ST_Point(25.3176, 82.9739)),
(320, 'Vishakhapatnam', ST_Point(17.6868, 83.2185)),
(321, 'Xian', ST_Point(34.3416, 108.9398)),
(322, 'Yinchuan', ST_Point(38.4872, 106.2309)),
(323, 'Zhengzhou', ST_Point(34.7466, 113.6254)),
(324, 'Quetta', ST_Point(30.1798, 66.9750)),
(325, 'Abu Dhabi', ST_Point(24.4539, 54.3773)),
(326, 'Almaty', ST_Point(43.2383, 76.9450)),
(327, 'Astana', ST_Point(51.1694, 71.4491)),
(328, 'Bishkek', ST_Point(42.8746, 74.5698)),
(329, 'Da Nang', ST_Point(16.0544, 108.2022)),
(330, 'Fukuoka', ST_Point(33.5904, 130.4017)),
(331, 'Hiroshima', ST_Point(34.3853, 132.4553)),
(332, 'Kanazawa', ST_Point(36.5613, 136.6562)),
(333, 'Kumamoto', ST_Point(32.8031, 130.7079)),
(334, 'Chongqing', ST_Point(29.5630, 106.5516)),
(335, 'Shenzhen', ST_Point(22.5431, 114.0579)),
(336, 'Kaohsiung', ST_Point(22.6273, 120.3014)),
(337, 'Nagoya', ST_Point(35.1815, 136.9066)),
(338, 'Shijiazhuang', ST_Point(38.0413, 114.5149)),
(339, 'Changsha', ST_Point(28.2282, 112.9388)),
(340, 'Shenyang', ST_Point(41.8057, 123.4315)),
(341, 'Nanjing', ST_Point(32.0603, 118.7969)),
(342, 'Dalian', ST_Point(38.9140, 121.6147)),
(343, 'Harbin', ST_Point(45.8038, 126.5349)),
(344, 'Suzhou', ST_Point(31.2983, 120.5832)),
(345, 'Ningbo', ST_Point(29.8683, 121.5439)),
(346, 'Fuzhou', ST_Point(26.0745, 119.2965)),
(347, 'Jinan', ST_Point(36.6512, 117.1201)),
(348, 'Xiamen', ST_Point(24.4798, 118.0894)),
(349, 'Qingdao', ST_Point(36.0671, 120.3826)),
(350, 'Urumqi', ST_Point(43.8256, 87.6168)),
(351, 'Hangzhou', ST_Point(30.2741, 120.1551)),
(352, 'Wuhan', ST_Point(30.5928, 114.3055)),
(353, 'Tianjin', ST_Point(39.3434, 117.3616)),
(354, 'Changchun', ST_Point(43.8160, 125.3235)),
(355, 'Zhengzhou', ST_Point(34.7473, 113.6249)),
(356, 'Hefei', ST_Point(31.8206, 117.2272)),
(357, 'Wenzhou', ST_Point(27.9949, 120.6994)),
(358, 'Guiyang', ST_Point(26.6470, 106.6302)),
(359, 'Hohhot', ST_Point(40.8183, 111.7652)),
(360, 'Lanzhou', ST_Point(36.0611, 103.8343)),
(361, 'Xuzhou', ST_Point(34.2044, 117.2858)),
(362, 'Wuxi', ST_Point(31.4912, 120.3119)),
(363, 'Zibo', ST_Point(36.8135, 118.0549)),
(364, 'Taizhou', ST_Point(32.4843, 119.9073)),
(365, 'Kunming', ST_Point(25.0389, 102.7183)),
(366, 'Lianyungang', ST_Point(34.6000, 119.1788)),
(367, 'Luoyang', ST_Point(34.6197, 112.4540)),
(368, 'Shaoxing', ST_Point(30.0303, 120.5802)),
(369, 'Yantai', ST_Point(37.4638, 121.4479)),
(370, 'Yangzhou', ST_Point(32.3926, 119.4127)),
(371, 'Quanzhou', ST_Point(24.8741, 118.6757)),
(372, 'Anshan', ST_Point(41.1086, 122.9946)),
(373, 'Weifang', ST_Point(36.7068, 119.1618)),
(374, 'Jining', ST_Point(35.4143, 116.5872)),
(375, 'Benxi', ST_Point(41.2886, 123.7650)),
(376, 'Dandong', ST_Point(40.1243, 124.3830)),
(377, 'Fushun', ST_Point(41.8809, 123.9572)),
(378, 'Zhuhai', ST_Point(22.2703, 113.5767)),
(379, 'Zhanjiang', ST_Point(21.1950, 110.4035)),
(380, 'Huizhou', ST_Point(23.1122, 114.4158)),
(381, 'Jiangmen', ST_Point(22.5787, 113.0819)),
(382, 'Nanning', ST_Point(22.8170, 108.3669)),
(383, 'Guilin', ST_Point(25.2742, 110.2991)),
(384, 'Haikou', ST_Point(20.0440, 110.1999)),
(385, 'Sanya', ST_Point(18.2536, 109.5119)),
(386, 'Yichang', ST_Point(30.7026, 111.2855)),
(387, 'Jiangyin', ST_Point(31.9206, 120.2854)),
(388, 'Yancheng', ST_Point(33.3495, 120.1636)),
(389, 'Zhenjiang', ST_Point(32.2044, 119.4554)),
(390, 'Luohe', ST_Point(33.5869, 114.0163)),
(391, 'Xinyang', ST_Point(32.1471, 114.0913)),
(392, 'Yichun', ST_Point(27.8200, 114.4000)),
(393, 'Jiujiang', ST_Point(29.7051, 116.0019)),
(394, 'Shangrao', ST_Point(28.4533, 117.9683)),
(395, 'Yingtan', ST_Point(28.2349, 117.0074)),
(396, 'Gongyi', ST_Point(34.7472, 112.9711)),
(397, 'Sanmenxia', ST_Point(34.7726, 111.2001)),
(398, 'Puyang', ST_Point(35.7619, 115.0293)),
(399, 'Xinxiang', ST_Point(35.3080, 113.8671)),
(400, 'Zhoukou', ST_Point(33.6262, 114.6418)),
(401, 'Hanzhong', ST_Point(33.0777, 107.0238)),
(402, 'Baoji', ST_Point(34.3601, 107.2375)),
(403, 'Yan', ST_Point(36.5854, 109.4897)),
(404, 'Dunhuang', ST_Point(40.1421, 94.6619)),
(405, 'Kashgar', ST_Point(39.4704, 75.9898)),
(406, 'Hotan', ST_Point(37.1118, 79.9217)),
(407, 'Aksu', ST_Point(41.1675, 80.2651)),
(408, 'Turpan', ST_Point(42.9513, 89.1896)),
(409, 'Karamay', ST_Point(45.5943, 84.8888)),
(410, 'Shihezi', ST_Point(44.3059, 86.0419)),
(411, 'Hami', ST_Point(42.8336, 93.5060)),
(412, 'Lhasa', ST_Point(29.6520, 91.1172)),
(413, 'Shigatse', ST_Point(29.2682, 88.8802)),
(414, 'Gyantse', ST_Point(28.9087, 89.6051)),
(415, 'Ngari', ST_Point(32.5000, 80.1000)),
(416, 'Nagqu', ST_Point(31.4792, 92.0513)),
(417, 'Chamdo', ST_Point(31.1385, 97.1796)),
(418, 'Yushu', ST_Point(33.0022, 97.0065)),
(419, 'Golmud', ST_Point(36.4064, 94.9033)),
(420, 'Xining', ST_Point(36.6171, 101.7782)),
(421, 'Yinchuan', ST_Point(38.4872, 106.2309)),
(422, 'Guyuan', ST_Point(36.0066, 106.2852)),
(423, 'Zhongwei', ST_Point(37.5134, 105.1884));`);
    return db;
  } catch (error) {
    console.error('Error initializing database:', error);

    return db;
  }
}
